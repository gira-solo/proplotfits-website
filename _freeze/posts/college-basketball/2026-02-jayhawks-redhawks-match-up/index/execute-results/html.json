{
  "hash": "5ff121a1ae12a3592dccad0d1b0e350f",
  "result": {
    "markdown": "---\ntitle: \"A Tale of Two Hawks Part 2\"\ndescription: \"A reproducible analysis of college basketball data with R\"\ndate: last-modified\ncategories: [college-basketball, tutorial, kansas, miami-oh]\nauthor: \"ProPlotFits\"\n---\n\n\n## Introduction\n\nFor context, please see Part 1 here.\n\n## What We're Looking For\n\nIf the goal is to use data to bet responsible AND share our results in reproducible manner, we need to isolate the data that helps us develop a model that predicts winners in potential match-ups.\n\nDean Oliver narrowed the most important analytics of college basketball down to Four Factors:\n\n1.  **Shooting Efficiency** - More baskets and fewer misses\n2.  **Turnovers** - Number of times losing a possession\n3.  **Rebounds** - Number of times gaining a possession\n4.  **Free Throws** - Free points\n\nAdditionally, there are **efficiency ratings** - points scored and allowed per 100 possessions - which help adjust for pace.\n\nWhen we talk about using machine learning to help us predict the outcome of match-ups, what we are actually doing is identifying features of a phenomena that could potentially assist us in determining outcomes. That is incredibly boiled down, but when we develop these predictive models, the models themselves let the analysts know what features are driving most of the explanation.\n\n------------------------------------------------------------------------\n\n## How You Can Use This\n\nWe are going to take a look at a hypothetical match-up between the Kansas Jayhawks and the Miami RedHawks. There is a *slight* chance they could in fact end up playing each other in the tournament IF they are in the same region. There is likely *no* chance they both make it to the Final Four.\n\nThis exact workflow works for any team in Division I basketball.\n\n**The steps:**\n\n1.  Load schedule and box scores with `hoopR`\n2.  Calculate four factors using the formulas above\n3.  Calculate efficiency ratings\n4.  Visualize trends with `ggplot2`\n5.  Compare head-to-head results\n\n------------------------------------------------------------------------\n\n## Step 1: Retrieve official ESPN data\n\nLoading data using the help of an R package named `hoopR`. You can learn more about its [documentation](https://hoopr.sportsdataverse.org/), but it's basically an API call to EPSN for live college basketball data.\n\nI am using other libraries of course, but we don't have time to talk about them!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\nlibrary(hoopR)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'hoopR' was built under R version 4.5.2\n```\n:::\n\n```{.r .cell-code}\nlibrary(janitor)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'janitor' was built under R version 4.5.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'janitor'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    chisq.test, fisher.test\n```\n:::\n\n```{.r .cell-code}\nschedule <- \n  load_mbb_schedule(seasons = 2026) |>\n  clean_names()\n\nbox_scores <- \n  load_mbb_team_box(seasons = 2026) |>\n  clean_names()\n\n# Filter to just Kansas & Miami\nhawks <- \n  box_scores |>\n  filter(team_display_name %in% c(\"Kansas Jayhawks\", \"Miami (OH) RedHawks\"))\n\n# Quick look at what we have\nstr(hawks[1:2,])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nhoopR_dt [2 Ã— 59] (S3: hoopR_data/tbl_df/tbl/data.table/data.frame)\n $ game_id                          : int [1:2] 401827690 401814572\n $ season                           : int [1:2] 2026 2026\n $ season_type                      : int [1:2] 2 2\n $ game_date                        : Date[1:2], format: \"2026-02-18\" \"2026-02-17\"\n $ game_date_time                   : POSIXct[1:2], format: \"2026-02-18 21:00:00\" \"2026-02-17 19:00:00\"\n $ team_id                          : int [1:2] 2305 193\n $ team_uid                         : chr [1:2] \"s:40~l:41~t:2305\" \"s:40~l:41~t:193\"\n $ team_slug                        : chr [1:2] \"kansas-jayhawks\" \"miami-oh-redhawks\"\n $ team_location                    : chr [1:2] \"Kansas\" \"Miami (OH)\"\n $ team_name                        : chr [1:2] \"Jayhawks\" \"RedHawks\"\n $ team_abbreviation                : chr [1:2] \"KU\" \"M-OH\"\n $ team_display_name                : chr [1:2] \"Kansas Jayhawks\" \"Miami (OH) RedHawks\"\n $ team_short_display_name          : chr [1:2] \"Kansas\" \"Miami OH\"\n $ team_color                       : chr [1:2] \"0051ba\" \"c41230\"\n $ team_alternate_color             : chr [1:2] \"e8000d\" \"ffffff\"\n $ team_logo                        : chr [1:2] \"https://a.espncdn.com/i/teamlogos/ncaa/500/2305.png\" \"https://a.espncdn.com/i/teamlogos/ncaa/500/193.png\"\n $ team_home_away                   : chr [1:2] \"away\" \"away\"\n $ team_score                       : int [1:2] 81 86\n $ team_winner                      : logi [1:2] TRUE TRUE\n $ assists                          : int [1:2] 20 16\n $ blocks                           : int [1:2] 7 1\n $ defensive_rebounds               : int [1:2] 31 22\n $ fast_break_points                : chr [1:2] \"10\" \"9\"\n $ field_goal_pct                   : num [1:2] 46 50\n $ field_goals_made                 : int [1:2] 28 26\n $ field_goals_attempted            : int [1:2] 61 52\n $ flagrant_fouls                   : int [1:2] 0 0\n $ fouls                            : int [1:2] 14 15\n $ free_throw_pct                   : num [1:2] 88 73\n $ free_throws_made                 : int [1:2] 14 24\n $ free_throws_attempted            : int [1:2] 16 33\n $ largest_lead                     : chr [1:2] \"23\" \"10\"\n $ lead_changes                     : chr [1:2] \"0\" \"2\"\n $ lead_percentage                  : chr [1:2] \"99\" \"91\"\n $ offensive_rebounds               : int [1:2] 10 4\n $ points_in_paint                  : chr [1:2] \"32\" \"28\"\n $ steals                           : int [1:2] 5 9\n $ team_turnovers                   : int [1:2] 0 1\n $ technical_fouls                  : int [1:2] 0 0\n $ three_point_field_goal_pct       : num [1:2] 46 43\n $ three_point_field_goals_made     : int [1:2] 11 10\n $ three_point_field_goals_attempted: int [1:2] 24 23\n $ total_rebounds                   : int [1:2] 41 26\n $ total_technical_fouls            : int [1:2] 0 0\n $ total_turnovers                  : int [1:2] 12 7\n $ turnover_points                  : chr [1:2] \"11\" \"14\"\n $ turnovers                        : int [1:2] 12 7\n $ opponent_team_id                 : int [1:2] 197 113\n $ opponent_team_uid                : chr [1:2] \"s:40~l:41~t:197\" \"s:40~l:41~t:113\"\n $ opponent_team_slug               : chr [1:2] \"oklahoma-state-cowboys\" \"massachusetts-minutemen\"\n $ opponent_team_location           : chr [1:2] \"Oklahoma State\" \"Massachusetts\"\n $ opponent_team_name               : chr [1:2] \"Cowboys\" \"Minutemen\"\n $ opponent_team_abbreviation       : chr [1:2] \"OKST\" \"MASS\"\n $ opponent_team_display_name       : chr [1:2] \"Oklahoma State Cowboys\" \"Massachusetts Minutemen\"\n $ opponent_team_short_display_name : chr [1:2] \"Oklahoma St\" \"UMass\"\n $ opponent_team_color              : chr [1:2] \"fe5c00\" \"881c1c\"\n $ opponent_team_alternate_color    : chr [1:2] \"000000\" \"ffffff\"\n $ opponent_team_logo               : chr [1:2] \"https://a.espncdn.com/i/teamlogos/ncaa/500/197.png\" \"https://a.espncdn.com/i/teamlogos/ncaa/500/113.png\"\n $ opponent_team_score              : int [1:2] 69 77\n - attr(*, \"hoopR_timestamp\")= POSIXct[1:1], format: \"2026-02-19 08:00:53\"\n - attr(*, \"hoopR_type\")= chr \"ESPN MBB Team Boxscores from hoopR data repository\"\n```\n:::\n:::\n\n\nI've taken the first two rows of our `hawks` data frame, which was filtered from the 2026 box score data stored in `box_scores` and told R to give me its structure. We have 59 columns; R lists them in order of appearance in the matrix, defines the type of data we are dealing with, shows us how many observations and then gives us a preview of said observations.\n\nWe can see that these are the most recent games for both teams.\n\n------------------------------------------------------------------------\n\n## Step 2: Calculate the Four Factors\n\nNow let's calculate Oliver's Four Factors for both teams.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfour_factors <- \n  hawks |>\n  mutate(\n    # Effective Field Goal % (weights three-pointers appropriately)\n    efg_pct = (field_goals_made + 0.5 * three_point_field_goals_made) / \n              field_goals_attempted,\n    \n    # Turnover % (turnovers per 100 possessions)\n    tov_pct = turnovers / \n              (field_goals_attempted + 0.44 * free_throws_attempted + turnovers),\n    \n    # Offensive Rebound % (offensive rebounds captured)\n    orb_pct = offensive_rebounds / \n              (offensive_rebounds + defensive_rebounds),\n    \n    # Free Throw Rate (free throw attempts per field goal attempt)\n    ft_rate = free_throws_made / field_goals_attempted\n  ) |>\n  select(team_display_name, game_date, team_score, opponent_team_score,\n         efg_pct, tov_pct, orb_pct, ft_rate)\n\n# Show the first few games\nhead(four_factors, 10) |> knitr::kable()\n```\n\n::: {.cell-output-display}\n|team_display_name   |game_date  | team_score| opponent_team_score|   efg_pct|   tov_pct|   orb_pct|   ft_rate|\n|:-------------------|:----------|----------:|-------------------:|---------:|---------:|---------:|---------:|\n|Kansas Jayhawks     |2026-02-18 |         81|                  69| 0.5491803| 0.1499250| 0.2439024| 0.2295082|\n|Miami (OH) RedHawks |2026-02-17 |         86|                  77| 0.5961538| 0.0952122| 0.1538462| 0.4615385|\n|Kansas Jayhawks     |2026-02-14 |         56|                  74| 0.4313725| 0.1841360| 0.2941176| 0.2352941|\n|Miami (OH) RedHawks |2026-02-13 |         90|                  74| 0.5948276| 0.1134644| 0.2105263| 0.3620690|\n|Kansas Jayhawks     |2026-02-09 |         82|                  78| 0.4420290| 0.1208791| 0.4146341| 0.3043478|\n|Miami (OH) RedHawks |2026-02-07 |         90|                  74| 0.6271186| 0.1600197| 0.3000000| 0.2711864|\n|Kansas Jayhawks     |2026-02-07 |         71|                  59| 0.5267857| 0.1369113| 0.1944444| 0.2142857|\n|Miami (OH) RedHawks |2026-02-03 |         73|                  71| 0.6034483| 0.1765345| 0.1785714| 0.0517241|\n|Kansas Jayhawks     |2026-02-02 |         64|                  61| 0.5094340| 0.2034726| 0.1315789| 0.1886792|\n|Kansas Jayhawks     |2026-01-31 |         90|                  82| 0.6696429| 0.0826902| 0.1250000| 0.2678571|\n:::\n:::\n\n\n------------------------------------------------------------------------\n\n## Step 3: Compare Season Averages\n\nLet's see which team has the edge in each factor.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nseason_averages <- \n  four_factors |>\n  group_by(team_display_name) |>\n  summarise(\n    games = n(),\n    avg_efg = mean(efg_pct, na.rm = TRUE),\n    avg_tov = mean(tov_pct, na.rm = TRUE),\n    avg_orb = mean(orb_pct, na.rm = TRUE),\n    avg_ftr = mean(ft_rate, na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\nlibrary(kableExtra)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'kableExtra' was built under R version 4.5.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'kableExtra'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:dplyr':\n\n    group_rows\n```\n:::\n\n```{.r .cell-code}\nseason_averages |>\n  knitr::kable(\n    digits = 3,\n    col.names = c(\"Team\", \"Games\", \"eFG%\", \"TOV%\", \"ORB%\", \"FTR\"),\n    caption = \"Season Averages: Four Factors\",\n    format = \"html\",\n    escape = FALSE\n  ) |>\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\")) |>\n  # Highlight max eFG% (higher is better)\n  column_spec(3, \n              background = ifelse(season_averages$avg_efg == max(season_averages$avg_efg),\n                                  \"#d4edda\", \"white\")) |>\n  # Highlight min TOV% (lower is better)  \n  column_spec(4,\n              background = ifelse(season_averages$avg_tov == min(season_averages$avg_tov),\n                                  \"#d4edda\", \"white\")) |>\n  # Highlight max ORB% (higher is better)\n  column_spec(5,\n              background = ifelse(season_averages$avg_orb == max(season_averages$avg_orb),\n                                  \"#d4edda\", \"white\")) |>\n  # Highlight max FTR (higher is better)\n  column_spec(6,\n              background = ifelse(season_averages$avg_ftr == max(season_averages$avg_ftr),\n                                  \"#d4edda\", \"white\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Season Averages: Four Factors</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Team </th>\n   <th style=\"text-align:right;\"> Games </th>\n   <th style=\"text-align:right;\"> eFG% </th>\n   <th style=\"text-align:right;\"> TOV% </th>\n   <th style=\"text-align:right;\"> ORB% </th>\n   <th style=\"text-align:right;\"> FTR </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Kansas Jayhawks </td>\n   <td style=\"text-align:right;\"> 26 </td>\n   <td style=\"text-align:right;background-color: white !important;\"> 0.535 </td>\n   <td style=\"text-align:right;background-color: white !important;\"> 0.136 </td>\n   <td style=\"text-align:right;background-color: rgba(212, 237, 218, 255) !important;\"> 0.244 </td>\n   <td style=\"text-align:right;background-color: white !important;\"> 0.259 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Miami (OH) RedHawks </td>\n   <td style=\"text-align:right;\"> 26 </td>\n   <td style=\"text-align:right;background-color: rgba(212, 237, 218, 255) !important;\"> 0.621 </td>\n   <td style=\"text-align:right;background-color: rgba(212, 237, 218, 255) !important;\"> 0.133 </td>\n   <td style=\"text-align:right;background-color: white !important;\"> 0.225 </td>\n   <td style=\"text-align:right;background-color: rgba(212, 237, 218, 255) !important;\"> 0.312 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n---\n\nWould you look at that. Miami's offense outperforms Kansas...if you completely ignore the quality of opponents Miami has played vs Kansas. The Big 12 has Houston, Arizona, Iowa State, Texas Tech and BYU in the AP Top 25 along with Kansas. Miami's best win as a 3-point home win over Akron.\n\n## Step 4: Visualize Shooting Efficiency\n\nLet's look at how consistent each team is at making shots.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfour_factors |>\n  ggplot(aes(x = team_display_name, y = efg_pct, fill = team_display_name)) +\n  geom_boxplot(alpha = 0.7, show.legend = FALSE) +\n  scale_fill_manual(\n    values = c(\"Kansas Jayhawks\" = \"#003262\", \n               \"Miami (OH) RedHawks\" = \"#8C1515\")\n  ) +\n  labs(\n    title = \"Shooting Efficiency: Kansas vs Miami\",\n    subtitle = \"Effective Field Goal Percentage Distribution\",\n    x = NULL,\n    y = \"eFG%\",\n    caption = \"Data: hoopR / ESPN | Higher = Better\"\n  ) +\n  theme_minimal(base_size = 14) +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 16),\n    panel.grid.major.x = element_blank()\n  ) +\n  coord_flip()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=768}\n:::\n:::\n\n\nIt's very likely Kansas is playing teams with much, much better defenses.\n\n## Step 5: Calculate Efficiency Ratings\n\nPoints per game is misleading because it depends on pace. A team that plays fast will score more points, but that doesn't mean they're better.\n\nEfficiency ratings adjust for pace by measuring points per 100 possessions.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nefficiency <- hawks %>%\n  mutate(\n    # Estimate possessions using the standard formula\n    possessions = field_goals_attempted - \n                  offensive_rebounds + \n                  turnovers + \n                  0.44 * free_throws_attempted,\n    \n    # Offensive Rating (points scored per 100 possessions)\n    ortg = (team_score / possessions) * 100,\n    \n    # Defensive Rating (points allowed per 100 possessions)\n    drtg = (opponent_team_score / possessions) * 100,\n    \n    # Net Rating (offense minus defense)\n    net_rating = ortg - drtg\n  ) %>%\n  select(team_display_name, game_date, possessions, ortg, drtg, net_rating)\n\n# Season averages\nefficiency_summary <- efficiency %>%\n  group_by(team_display_name) %>%\n  summarise(\n    avg_pace = mean(possessions, na.rm = TRUE),\n    avg_ortg = mean(ortg, na.rm = TRUE),\n    avg_drtg = mean(drtg, na.rm = TRUE),\n    avg_net = mean(net_rating, na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\nefficiency_summary %>%\n  knitr::kable(\n    digits = 1,\n    col.names = c(\"Team\", \"Pace\", \"ORtg\", \"DRtg\", \"Net Rating\"),\n    caption = \"Efficiency Ratings (per 100 possessions)\"\n  )\n```\n\n::: {.cell-output-display}\nTable: Efficiency Ratings (per 100 possessions)\n\n|Team                | Pace|  ORtg|  DRtg| Net Rating|\n|:-------------------|----:|-----:|-----:|----------:|\n|Kansas Jayhawks     | 67.9| 113.8| 100.1|       13.7|\n|Miami (OH) RedHawks | 72.4| 127.0| 102.7|       24.3|\n:::\n:::\n\n\n**Offensive Rating (ORtg):** Points per 100 possessions\n\n**Defensive Rating (DRtg):** Points allowed per 100 possessions\n\n**Net Rating:** Offensive Rating minus Defensive Rating\n\n## Step 6: Recent Form (Last 10 Games)\n\nLet's see who's trending up and who's trending down.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nefficiency %>%\n  group_by(team_display_name) %>%\n  arrange(game_date) %>%\n  mutate(game_num = row_number()) %>%\n  filter(game_num > max(game_num) - 10) %>%\n  ggplot(aes(x = game_num, y = net_rating, color = team_display_name)) +\n  geom_line(linewidth = 1.2) +\n  geom_point(size = 3) +\n  geom_hline(yintercept = 0, linetype = \"dashed\", color = \"gray50\") +\n  geom_smooth(method = \"lm\", se = FALSE, linetype = \"dashed\", linewidth = 0.8) +\n  scale_color_manual(\n    values = c(\"Kansas Jayhawks\" = \"#003262\", \n               \"Miami (OH) RedHawks\" = \"#8C1515\")\n  ) +\n  labs(\n    title = \"Net Rating Trend: Last 10 Games\",\n    subtitle = \"Positive = good, upward trend = improving\",\n    x = \"Game Number (Most Recent 10)\",\n    y = \"Net Rating\",\n    color = \"Team\",\n    caption = \"Data: hoopR / ESPN\"\n  ) +\n  theme_minimal(base_size = 14) +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 16),\n    legend.position = \"bottom\"\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=864}\n:::\n:::\n\n\nMiami appears to be in a more stable position than Kansas. As a unit, Miami definitely seems more consistent.\n\n## Conclusion\n\nThis workflow can be reproduced for any of the 360+ Division-1 Mens' Basketball Teams. In Part 3 of this series, we'll walk through how to build machine learning models to incorporate all of this data and predict who would win in a potential match-up between Kansas and Miami, the margin of victory and the total points scored.\n\n*Want to see more analyses like this? Subscribe to our Telegram for daily picks and breakdowns.*\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\r\n<link href=\"../../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}